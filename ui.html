<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>A11y Audit Pro</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Shadcn-inspired Color System */
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      
      --primary: 222.2 47.4% 11.2%;
      --primary-foreground: 210 40% 98%;
      
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      
      --success: 142 71% 45%;
      --success-foreground: 355.7 100% 97.3%;
      
      --warning: 48 96% 53%;
      --warning-foreground: 26 90% 10%;
      
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      
      --border: 214.3 31.8% 91.4%;
      --radius: 0.5rem;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
      font-size: 14px;
      color: hsl(var(--foreground));
      background: hsl(var(--background));
      line-height: 1.5;
    }

    /* Container */
    .container {
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Hidden utility */
    .hidden {
      display: none !important;
    }

    /* ========================================
       ONBOARDING SCREENS
    ======================================== */
    .onboarding-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(var(--background));
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 24px;
    }

    .onboarding-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .onboarding-logo {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .onboarding-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: hsl(var(--foreground));
    }

    .onboarding-subtitle {
      font-size: 14px;
      color: hsl(var(--muted-foreground));
    }

    .onboarding-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .feature-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 32px;
    }

    .feature-item {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .feature-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .feature-text h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .feature-text p {
      font-size: 13px;
      color: hsl(var(--muted-foreground));
    }

    .onboarding-footer {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 32px;
    }

    .progress-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .progress-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: hsl(var(--muted));
      transition: all 0.2s;
    }

    .progress-dot.active {
      background: hsl(var(--primary));
      width: 24px;
      border-radius: 4px;
    }

    /* WCAG Version Selector in Onboarding */
    .version-selector {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .version-option {
      padding: 16px;
      border: 2px solid hsl(var(--border));
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s;
    }

    .version-option:hover {
      border-color: hsl(var(--primary));
      background: hsl(var(--muted));
    }

    .version-option.selected {
      border-color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    .version-option h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .version-option p {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    /* ========================================
       LOGIN / SIGNUP SCREENS
    ======================================== */
    .auth-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(var(--background));
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .auth-container {
      width: 100%;
      max-width: 360px;
    }

    .auth-logo {
      text-align: center;
      font-size: 48px;
      margin-bottom: 24px;
    }

    .auth-title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
    }

    .auth-subtitle {
      font-size: 14px;
      color: hsl(var(--muted-foreground));
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-label {
      font-size: 13px;
      font-weight: 500;
      color: hsl(var(--foreground));
    }

    .form-input {
      padding: 10px 12px;
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      font-size: 14px;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: hsl(var(--primary));
      box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
    }

    .auth-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 16px 0;
    }

    .auth-divider::before,
    .auth-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: hsl(var(--border));
    }

    .auth-divider span {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    .auth-footer {
      text-align: center;
      margin-top: 24px;
      font-size: 13px;
      color: hsl(var(--muted-foreground));
    }

    .auth-link {
      color: hsl(var(--primary));
      cursor: pointer;
      text-decoration: none;
      font-weight: 500;
    }

    .auth-link:hover {
      text-decoration: underline;
    }

    /* ========================================
       PRICING SCREEN
    ======================================== */
    .pricing-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(var(--background));
      z-index: 1000;
      overflow-y: auto;
      padding: 24px;
    }

    .pricing-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .pricing-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .pricing-subtitle {
      font-size: 14px;
      color: hsl(var(--muted-foreground));
    }

    .pricing-cards {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .pricing-card {
      border: 2px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      padding: 24px;
      transition: all 0.2s;
    }

    .pricing-card:hover {
      border-color: hsl(var(--primary));
      box-shadow: 0 8px 24px hsl(var(--foreground) / 0.08);
    }

    .pricing-card.featured {
      border-color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.03);
      position: relative;
    }

    .pricing-badge {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 4px 12px;
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .pricing-plan-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .pricing-price {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .pricing-price span {
      font-size: 16px;
      font-weight: 400;
      color: hsl(var(--muted-foreground));
    }

    .pricing-description {
      font-size: 13px;
      color: hsl(var(--muted-foreground));
      margin-bottom: 20px;
    }

    .pricing-features {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .pricing-feature {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 13px;
    }

    .pricing-feature-icon {
      color: hsl(var(--success));
      flex-shrink: 0;
      margin-top: 2px;
    }

    /* ========================================
       HEADER
    ======================================== */
    .header {
      padding: 16px;
      border-bottom: 1px solid hsl(var(--border));
      background: hsl(var(--background));
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      flex: 1;
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .header-subtitle {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    /* ========================================
       BUTTONS (Shadcn-inspired)
    ======================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      white-space: nowrap;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }

    .btn-primary:hover:not(:disabled) {
      background: hsl(var(--primary) / 0.9);
    }

    .btn-secondary {
      background: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }

    .btn-secondary:hover:not(:disabled) {
      background: hsl(var(--secondary) / 0.8);
    }

    .btn-ghost {
      background: transparent;
      color: hsl(var(--foreground));
    }

    .btn-ghost:hover:not(:disabled) {
      background: hsl(var(--muted));
    }

    .btn-destructive {
      background: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
    }

    .btn-destructive:hover:not(:disabled) {
      background: hsl(var(--destructive) / 0.9);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    .btn-lg {
      padding: 12px 20px;
      font-size: 15px;
    }

    .btn-full {
      width: 100%;
    }

    /* ========================================
       TABS
    ======================================== */
    .tabs {
      display: flex;
      border-bottom: 1px solid hsl(var(--border));
      background: hsl(var(--background));
    }

    .tab-btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: hsl(var(--muted-foreground));
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }

    .tab-btn:hover {
      color: hsl(var(--foreground));
      background: hsl(var(--muted));
    }

    .tab-btn.active {
      color: hsl(var(--primary));
      border-bottom-color: hsl(var(--primary));
    }

    /* ========================================
       TAB CONTENT
    ======================================== */
    .tab-content {
      padding: 16px;
      flex: 1;
      overflow-y: auto;
    }

    /* ========================================
       ALERT (Change Detection)
    ======================================== */
    .alert {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: var(--radius);
      border-left: 4px solid;
    }

    .alert-warning {
      background: hsl(var(--warning) / 0.1);
      border-left-color: hsl(var(--warning));
    }

    .alert-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .alert-content {
      flex: 1;
    }

    .alert-content strong {
      display: block;
      margin-bottom: 2px;
      font-size: 13px;
    }

    .alert-content p {
      margin: 0;
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    /* ========================================
       CARD (Shadcn-inspired)
    ======================================== */
    .card {
      background: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 16px;
    }

    .card-header {
      padding: 16px;
      border-bottom: 1px solid hsl(var(--border));
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-description {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    .card-content {
      padding: 16px;
    }

    .card-footer {
      padding: 16px;
      border-top: 1px solid hsl(var(--border));
      display: flex;
      gap: 8px;
    }

    /* ========================================
       BADGE
    ======================================== */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-success {
      background: hsl(var(--success) / 0.1);
      color: hsl(var(--success));
    }

    .badge-warning {
      background: hsl(var(--warning) / 0.1);
      color: hsl(var(--warning-foreground));
    }

    .badge-destructive {
      background: hsl(var(--destructive) / 0.1);
      color: hsl(var(--destructive));
    }

    .badge-secondary {
      background: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }

    /* ========================================
       FORM ELEMENTS
    ======================================== */
    .select,
    .input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      font-size: 14px;
      transition: all 0.2s;
    }

    .select:focus,
    .input:focus {
      outline: none;
      border-color: hsl(var(--primary));
      box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: hsl(var(--border));
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: hsl(var(--primary));
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: hsl(var(--primary));
      cursor: pointer;
      border: none;
    }

    /* ========================================
       EMPTY STATE
    ======================================== */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: hsl(var(--muted-foreground));
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: hsl(var(--foreground));
    }

    .empty-state p {
      font-size: 14px;
      margin-bottom: 16px;
    }

    /* ========================================
       LOADING STATE
    ======================================== */
    .loading {
      text-align: center;
      padding: 48px 24px;
    }

    .spinner {
      border: 3px solid hsl(var(--border));
      border-top: 3px solid hsl(var(--primary));
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ========================================
       TOAST NOTIFICATION
    ======================================== */
    .toast {
      position: fixed;
      bottom: 16px;
      right: 16px;
      min-width: 280px;
      background: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 10px 25px hsl(var(--foreground) / 0.1);
      display: flex;
      gap: 12px;
      align-items: start;
      z-index: 9999;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .toast-success {
      border-left: 4px solid hsl(var(--success));
    }

    .toast-error {
      border-left: 4px solid hsl(var(--destructive));
    }

    .toast-warning {
      border-left: 4px solid hsl(var(--warning));
    }

    .toast-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 13px;
    }

    .toast-message {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
    }

    .toast-close {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: hsl(var(--muted-foreground));
      padding: 0;
      width: 20px;
      height: 20px;
    }

    /* ========================================
       ISSUE CARDS
    ======================================== */
    .issue-card {
      background: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-left: 4px solid;
      border-radius: var(--radius);
      padding: 12px;
      margin-bottom: 12px;
    }

    .issue-card.fail {
      border-left-color: hsl(var(--destructive));
      background: hsl(var(--destructive) / 0.03);
    }

    .issue-card.warning {
      border-left-color: hsl(var(--warning));
      background: hsl(var(--warning) / 0.03);
    }

    .issue-card.pass {
      border-left-color: hsl(var(--success));
      background: hsl(var(--success) / 0.03);
    }

    .issue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .issue-title {
      font-weight: 600;
      font-size: 14px;
    }

    .issue-details {
      font-size: 12px;
      color: hsl(var(--muted-foreground));
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .issue-fix {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid hsl(var(--border));
    }

    /* ========================================
       INFO BOX
    ======================================== */
    .info-box {
      background: hsl(var(--primary) / 0.05);
      border-left: 3px solid hsl(var(--primary));
      padding: 12px;
      margin: 12px 0;
      border-radius: 4px;
      font-size: 12px;
      line-height: 1.5;
    }

    /* ========================================
       SETTINGS SECTIONS
    ======================================== */
    .settings-group {
      margin-bottom: 24px;
    }

    .settings-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .settings-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    /* ========================================
       UPGRADE PROMPT
    ======================================== */
    .upgrade-prompt {
      background: linear-gradient(135deg, hsl(var(--primary) / 0.1), hsl(var(--success) / 0.1));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      text-align: center;
    }

    .upgrade-prompt h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .upgrade-prompt p {
      font-size: 13px;
      color: hsl(var(--muted-foreground));
      margin-bottom: 16px;
    }

    .upgrade-badge {
      display: inline-block;
      padding: 6px 12px;
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- ========================================
         ONBOARDING SCREENS
    ======================================== -->
    
    <!-- Onboarding Screen 1: Welcome -->
    <div id="onboarding-1" class="onboarding-screen hidden">
      <div class="onboarding-header">
        <div class="onboarding-logo">üéØ</div>
        <h1 class="onboarding-title">Welcome to A11y Audit Pro</h1>
        <p class="onboarding-subtitle">Make Your Designs Accessible for Everyone</p>
      </div>
      
      <div class="onboarding-content">
        <div class="feature-list">
          <div class="feature-item">
            <div class="feature-icon">‚úì</div>
            <div class="feature-text">
              <h3>WCAG 2.0/2.1/2.2 Checking</h3>
              <p>Comprehensive accessibility compliance testing</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">ü§ñ</div>
            <div class="feature-text">
              <h3>AI-Powered Fix Suggestions</h3>
              <p>Get plain English suggestions with one-click fixes</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üë•</div>
            <div class="feature-text">
              <h3>Team Collaboration</h3>
              <p>Share findings and track progress together</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="onboarding-footer">
        <div class="progress-dots">
          <div class="progress-dot active"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="nextOnboarding()">Get Started</button>
        <button class="btn btn-ghost btn-full" onclick="skipOnboarding()">Skip Tour</button>
      </div>
    </div>

    <!-- Onboarding Screen 2: How It Works -->
    <div id="onboarding-2" class="onboarding-screen hidden">
      <div class="onboarding-header">
        <h1 class="onboarding-title">How A11y Audit Works</h1>
        <p class="onboarding-subtitle">Three simple steps to accessible designs</p>
      </div>
      
      <div class="onboarding-content">
        <div class="feature-list">
          <div class="feature-item">
            <div class="feature-icon">1Ô∏è‚É£</div>
            <div class="feature-text">
              <h3>Select Frame</h3>
              <p>Choose any frame in your Figma design to analyze</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">2Ô∏è‚É£</div>
            <div class="feature-text">
              <h3>Run Analysis</h3>
              <p>Get instant WCAG feedback on your design</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">3Ô∏è‚É£</div>
            <div class="feature-text">
              <h3>Apply Fixes</h3>
              <p>One-click fixes make your design accessible</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="onboarding-footer">
        <div class="progress-dots">
          <div class="progress-dot"></div>
          <div class="progress-dot active"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="nextOnboarding()">Next</button>
        <button class="btn btn-ghost btn-full" onclick="skipOnboarding()">Skip Tour</button>
      </div>
    </div>

    <!-- Onboarding Screen 3: Select WCAG Version -->
    <div id="onboarding-3" class="onboarding-screen hidden">
      <div class="onboarding-header">
        <h1 class="onboarding-title">Choose Your WCAG Standard</h1>
        <p class="onboarding-subtitle">Select based on your requirements</p>
      </div>
      
      <div class="onboarding-content">
        <div class="version-selector">
          <div class="version-option" data-version="2.1" data-level="AA" onclick="selectWCAGVersion(this)">
            <h4>‚≠ê WCAG 2.1 AA (Recommended)</h4>
            <p>Most common standard. Includes mobile and touch accessibility.</p>
          </div>
          <div class="version-option" data-version="2.2" data-level="AA" onclick="selectWCAGVersion(this)">
            <h4>WCAG 2.2 AA (Latest)</h4>
            <p>Latest standard from 2023. Includes focus appearance.</p>
          </div>
          <div class="version-option" data-version="2.0" data-level="AA" onclick="selectWCAGVersion(this)">
            <h4>WCAG 2.0 AA</h4>
            <p>Widely supported. Required for US Section 508.</p>
          </div>
        </div>
        <div class="info-box">
          üí° You can change this anytime in Settings
        </div>
      </div>
      
      <div class="onboarding-footer">
        <div class="progress-dots">
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot active"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="nextOnboarding()">Continue</button>
        <button class="btn btn-ghost btn-full" onclick="skipOnboarding()">Skip Tour</button>
      </div>
    </div>

    <!-- Onboarding Screen 4: Try It Now -->
    <div id="onboarding-4" class="onboarding-screen hidden">
      <div class="onboarding-header">
        <h1 class="onboarding-title">Let's Analyze a Frame!</h1>
        <p class="onboarding-subtitle">Select a frame in Figma to get started</p>
      </div>
      
      <div class="onboarding-content">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Current Selection</div>
            <div class="card-description" id="onboarding-frame-info">
              No frame selected yet
            </div>
          </div>
          <div class="card-content">
            <p style="font-size: 13px; color: hsl(var(--muted-foreground)); margin-bottom: 16px;">
              Select any frame in your Figma file, then click the button below to run your first analysis.
            </p>
            <button class="btn btn-primary btn-full" id="onboarding-analyze-btn" disabled onclick="runOnboardingAnalysis()">
              üîç Analyze This Frame
            </button>
          </div>
        </div>
      </div>
      
      <div class="onboarding-footer">
        <div class="progress-dots">
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot active"></div>
          <div class="progress-dot"></div>
        </div>
        <button class="btn btn-ghost btn-full" onclick="nextOnboarding()">Skip This Step</button>
      </div>
    </div>

    <!-- Onboarding Screen 5: Pricing (Optional) -->
    <div id="onboarding-5" class="onboarding-screen hidden">
      <div class="onboarding-header">
        <h1 class="onboarding-title">üéâ You're All Set!</h1>
        <p class="onboarding-subtitle">Start with our free plan</p>
      </div>
      
      <div class="onboarding-content">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Free Plan</div>
            <div class="card-description">10 analyses per month</div>
          </div>
          <div class="card-content">
            <p style="font-size: 13px; margin-bottom: 16px;">
              You're starting with our free plan. Need unlimited analyses?
            </p>
            <div style="background: hsl(var(--primary) / 0.1); padding: 16px; border-radius: var(--radius); margin-bottom: 16px;">
              <div style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">$9<span style="font-size: 14px; font-weight: 400;">/month</span></div>
              <div style="font-size: 12px; color: hsl(var(--muted-foreground)); margin-bottom: 12px;">Pro Plan</div>
              <div style="font-size: 12px; margin-bottom: 8px;">‚úì Unlimited analyses</div>
              <div style="font-size: 12px; margin-bottom: 8px;">‚úì AI-powered suggestions</div>
              <div style="font-size: 12px; margin-bottom: 8px;">‚úì Export reports</div>
              <div style="font-size: 12px;">‚úì Priority support</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="onboarding-footer">
        <div class="progress-dots">
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot active"></div>
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="showPricingScreen()">View Pricing</button>
        <button class="btn btn-ghost btn-full" onclick="completeOnboarding()">Start with Free Plan</button>
      </div>
    </div>

    <!-- ========================================
         LOGIN / SIGNUP SCREENS
    ======================================== -->
    
    <!-- Login Screen -->
    <div id="login-screen" class="auth-screen hidden">
      <div class="auth-container">
        <div class="auth-logo">üéØ</div>
        <h1 class="auth-title">Welcome Back</h1>
        <p class="auth-subtitle">Sign in to your A11y Audit Pro account</p>
        
        <form class="auth-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="login-email" placeholder="you@example.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <button type="submit" class="btn btn-primary btn-lg btn-full">Sign In</button>
        </form>
        
        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <button class="btn btn-secondary btn-lg btn-full" onclick="signInWithFigma()">
          Sign in with Figma
        </button>
        
        <div class="auth-footer">
          Don't have an account? <a class="auth-link" onclick="showSignupScreen()">Sign up</a>
        </div>
      </div>
    </div>

    <!-- Signup Screen -->
    <div id="signup-screen" class="auth-screen hidden">
      <div class="auth-container">
        <div class="auth-logo">üéØ</div>
        <h1 class="auth-title">Create Account</h1>
        <p class="auth-subtitle">Start making accessible designs today</p>
        
        <form class="auth-form" onsubmit="handleSignup(event)">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" id="signup-name" placeholder="John Doe" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="signup-email" placeholder="you@example.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <button type="submit" class="btn btn-primary btn-lg btn-full">Create Account</button>
        </form>
        
        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <button class="btn btn-secondary btn-lg btn-full" onclick="signInWithFigma()">
          Sign up with Figma
        </button>
        
        <div class="auth-footer">
          Already have an account? <a class="auth-link" onclick="showLoginScreen()">Sign in</a>
        </div>
      </div>
    </div>

    <!-- ========================================
         PRICING SCREEN
    ======================================== -->
    
    <div id="pricing-screen" class="pricing-screen hidden">
      <div class="pricing-header">
        <h1 class="pricing-title">Choose Your Plan</h1>
        <p class="pricing-subtitle">Upgrade anytime. Cancel anytime.</p>
      </div>
      
      <div class="pricing-cards">
        <!-- Free Plan -->
        <div class="pricing-card">
          <div class="pricing-plan-name">Free</div>
          <div class="pricing-price">$0<span>/month</span></div>
          <div class="pricing-description">Perfect for trying out A11y Audit Pro</div>
          <div class="pricing-features">
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>10 frame analyses per month</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Basic WCAG 2.2 AA checks</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Visual overlays</span>
            </div>
          </div>
          <button class="btn btn-secondary btn-full" onclick="selectPlan('free')">Current Plan</button>
        </div>

        <!-- Pro Plan (Featured) -->
        <div class="pricing-card featured">
          <div class="pricing-badge">Most Popular</div>
          <div class="pricing-plan-name">Pro</div>
          <div class="pricing-price">$9<span>/month</span></div>
          <div class="pricing-description">For professional designers</div>
          <div class="pricing-features">
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Unlimited frame analyses</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Full WCAG 2.0/2.1/2.2 AA & AAA</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Persistent history (unlimited)</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>AI-powered fix suggestions</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Export reports (PDF/CSV)</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Priority email support</span>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="selectPlan('pro')">Upgrade to Pro</button>
        </div>

        <!-- Team Plan -->
        <div class="pricing-card">
          <div class="pricing-plan-name">Team</div>
          <div class="pricing-price">$29<span>/month</span></div>
          <div class="pricing-description">For 5 seats ($5.80 per seat)</div>
          <div class="pricing-features">
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Everything in Pro, plus:</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Team workspace (shared history)</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Collaborative comments</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Assign issues to team members</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Team analytics dashboard</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Bulk frame analysis</span>
            </div>
            <div class="pricing-feature">
              <span class="pricing-feature-icon">‚úì</span>
              <span>Priority support + Slack channel</span>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="selectPlan('team')">Upgrade to Team</button>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 24px;">
        <button class="btn btn-ghost" onclick="closePricingScreen()">Maybe Later</button>
      </div>
    </div>

    <!-- ========================================
         MAIN APP (After Onboarding/Login)
    ======================================== -->
    
    <div id="main-app" class="hidden" style="display: flex; flex-direction: column; min-height: 100vh;">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <div class="header-title">üéØ A11y Audit Pro</div>
          <div class="header-subtitle" id="user-plan-badge">Free Plan: 10/10 analyses</div>
        </div>
        <div class="header-actions">
          <button class="btn btn-sm btn-ghost" onclick="showSettings()">‚öôÔ∏è</button>
          <button class="btn btn-sm btn-secondary" onclick="showPricingScreen()">Upgrade</button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="analyze" onclick="switchTab('analyze')">Analyze</button>
        <button class="tab-btn" data-tab="history" onclick="switchTab('history')">History</button>
        <button class="tab-btn" data-tab="settings" onclick="switchTab('settings')">Settings</button>
      </div>

      <!-- Analyze Tab -->
      <div class="tab-content" id="analyze-tab">
        <!-- Change Alert -->
        <div id="change-alert" class="alert alert-warning hidden">
          <div class="alert-icon">‚ö†Ô∏è</div>
          <div class="alert-content">
            <strong>Frame Modified</strong>
            <p>This frame has been changed since last analysis.</p>
          </div>
          <button class="btn btn-primary btn-sm" onclick="reanalyzeFrame()">
            Re-analyze
          </button>
          <button class="btn btn-ghost btn-sm" onclick="dismissChangeAlert()">
            Dismiss
          </button>
        </div>

        <!-- Frame Info -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">Selected Frame</div>
            <div class="card-description" id="frame-info-text">
              No frame selected
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary btn-full" id="analyze-btn" onclick="analyzeFrame()" disabled>
              üîç Analyze Frame
            </button>
          </div>
        </div>

        <!-- Results -->
        <div id="results-container">
          <div class="empty-state">
            <div class="empty-state-icon">üé®</div>
            <h3>Ready to Analyze</h3>
            <p>Select a frame and click "Analyze Frame" to check for accessibility issues.</p>
          </div>
        </div>
      </div>

      <!-- History Tab -->
      <div class="tab-content hidden" id="history-tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Analysis History</div>
            <div class="card-description">Your recent accessibility checks</div>
          </div>
          <div class="card-content">
            <div id="history-list">
              <div class="loading">
                <div class="spinner"></div>
                <p>Loading history...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div class="tab-content hidden" id="settings-tab">
        <!-- WCAG Standard -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">üìã WCAG Standard</div>
            <div class="card-description">Choose your compliance level</div>
          </div>
          <div class="card-content">
            <div class="settings-group">
              <label class="settings-label">Version</label>
              <select class="select" id="wcag-version" onchange="updateWCAGDescription()">
                <option value="2.0">WCAG 2.0</option>
                <option value="2.1" selected>WCAG 2.1 (Recommended)</option>
                <option value="2.2">WCAG 2.2 (Latest)</option>
              </select>
            </div>
            
            <div class="settings-group">
              <label class="settings-label">Level</label>
              <select class="select" id="wcag-level" onchange="updateWCAGDescription()">
                <option value="AA" selected>AA (Minimum Compliance)</option>
                <option value="AAA">AAA (Enhanced Compliance)</option>
              </select>
            </div>
            
            <div class="info-box" id="wcag-description">
              WCAG 2.1 AA is recommended. Includes mobile and touch accessibility requirements.
            </div>
          </div>
        </div>

        <!-- Checks to Perform -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">üé® Checks to Perform</div>
            <div class="card-description">Choose which tests to run</div>
          </div>
          <div class="card-content">
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="check-color-contrast" checked>
              <span>Color Contrast</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="check-text-spacing" checked>
              <span>Text Spacing (WCAG 2.1+)</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="check-line-height" checked>
              <span>Line Height</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="check-paragraph-spacing" checked>
              <span>Paragraph Spacing</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="check-non-text-contrast" checked>
              <span>Non-text Contrast (WCAG 2.1+)</span>
            </label>
            <label class="checkbox-wrapper" style="opacity: 0.5;">
              <input type="checkbox" class="checkbox" id="check-touch-targets" disabled>
              <span>Touch Target Size (Coming Soon)</span>
            </label>
          </div>
        </div>

        <!-- Display Options -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">üéØ Display Options</div>
            <div class="card-description">Customize how issues are shown</div>
          </div>
          <div class="card-content">
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="show-overlays" checked>
              <span>Show Visual Overlays</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="group-by-element" checked>
              <span>Group Issues by Element</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" class="checkbox" id="show-only-failures">
              <span>Show Only Failing Checks</span>
            </label>
            
            <div class="settings-group" style="margin-top: 16px;">
              <div class="settings-row">
                <label class="settings-label">Overlay Opacity</label>
                <span id="opacity-value">70%</span>
              </div>
              <input type="range" class="slider" id="overlay-opacity" min="0" max="100" value="70" oninput="updateOpacityValue(this.value)">
            </div>
          </div>
        </div>

        <!-- Cache Settings -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">üíæ Cache Settings</div>
            <div class="card-description">Manage cached analyses</div>
          </div>
          <div class="card-content">
            <div class="settings-group">
              <label class="settings-label">Cache TTL (days)</label>
              <input type="number" class="input" id="cache-ttl" value="7" min="1" max="30">
            </div>
            
            <div class="info-box" id="cache-size-info">
              Current Cache: Calculating...
            </div>
            
            <button class="btn btn-destructive btn-full" onclick="clearAllCache()">
              Clear All Cache
            </button>
          </div>
        </div>

        <!-- Save Settings Button -->
        <div style="padding: 0 16px 16px;">
          <button class="btn btn-primary btn-full btn-lg" onclick="saveSettings()">
            üíæ Save Settings
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <script>
    // ========================================
    // STATE MANAGEMENT
    // ========================================
    let currentOnboardingStep = 1;
    let selectedWCAGVersion = '2.1';
    let selectedWCAGLevel = 'AA';
    let isAuthenticated = false;
    let currentUser = null;
    let currentPlan = 'free';
    let analysisCount = 0;
    let analysisLimit = 10;

    // ========================================
    // ONBOARDING FUNCTIONS
    // ========================================
    function showOnboarding() {
      currentOnboardingStep = 1;
      hideAllScreens();
      document.getElementById('onboarding-1').classList.remove('hidden');
    }

    function nextOnboarding() {
      document.getElementById(`onboarding-${currentOnboardingStep}`).classList.add('hidden');
      currentOnboardingStep++;
      
      if (currentOnboardingStep <= 5) {
        document.getElementById(`onboarding-${currentOnboardingStep}`).classList.remove('hidden');
      } else {
        completeOnboarding();
      }
    }

    function skipOnboarding() {
      if (confirm('Skip the tour? You can always access help later.')) {
        completeOnboarding();
      }
    }

    function completeOnboarding() {
      localStorage.setItem('a11y-onboarding-completed', 'true');
      hideAllScreens();
      showMainApp();
      showToast('Welcome to A11y Audit Pro!', 'Ready to make your designs accessible.', 'success');
    }

    function selectWCAGVersion(element) {
      // Remove selection from all options
      document.querySelectorAll('.version-option').forEach(el => {
        el.classList.remove('selected');
      });
      
      // Add selection to clicked option
      element.classList.add('selected');
      
      // Store selection
      selectedWCAGVersion = element.dataset.version;
      selectedWCAGLevel = element.dataset.level;
    }

    function runOnboardingAnalysis() {
      // Trigger analysis and move to next step
      parent.postMessage({ 
        pluginMessage: { 
          type: 'analyze',
          forceReanalyze: false,
          showOverlay: true,
          checks: getEnabledChecks()
        } 
      }, '*');
      
      setTimeout(() => {
        nextOnboarding();
      }, 1000);
    }

    // ========================================
    // AUTH FUNCTIONS
    // ========================================
    function showLoginScreen() {
      hideAllScreens();
      document.getElementById('login-screen').classList.remove('hidden');
    }

    function showSignupScreen() {
      hideAllScreens();
      document.getElementById('signup-screen').classList.remove('hidden');
    }

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      // TODO: Implement actual authentication
      console.log('Login attempt:', email);
      
      // Simulate login success
      isAuthenticated = true;
      currentUser = { email, name: email.split('@')[0] };
      
      hideAllScreens();
      showMainApp();
      showToast('Welcome back!', 'You\'re now signed in.', 'success');
    }

    function handleSignup(event) {
      event.preventDefault();
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      // TODO: Implement actual authentication
      console.log('Signup attempt:', { name, email });
      
      // Simulate signup success
      isAuthenticated = true;
      currentUser = { email, name };
      
      hideAllScreens();
      showOnboarding();
    }

    function signInWithFigma() {
      // TODO: Implement Figma OAuth
      showToast('Figma Sign-In', 'Coming soon! Use email for now.', 'warning');
    }

    // ========================================
    // PRICING FUNCTIONS
    // ========================================
    function showPricingScreen() {
      hideAllScreens();
      document.getElementById('pricing-screen').classList.remove('hidden');
    }

    function closePricingScreen() {
      hideAllScreens();
      showMainApp();
    }

    function selectPlan(plan) {
      if (plan === 'free') {
        showToast('Current Plan', 'You\'re already on the Free plan.', 'info');
        return;
      }
      
      // TODO: Implement Stripe checkout
      showToast('Upgrade', `Upgrading to ${plan} plan...`, 'success');
      console.log('Selected plan:', plan);
      
      // Simulate plan selection
      currentPlan = plan;
      if (plan === 'pro') {
        analysisLimit = 999999; // Unlimited
      } else if (plan === 'team') {
        analysisLimit = 999999; // Unlimited
      }
      
      updatePlanBadge();
      closePricingScreen();
    }

    function updatePlanBadge() {
      const badge = document.getElementById('user-plan-badge');
      if (currentPlan === 'free') {
        badge.textContent = `Free Plan: ${analysisCount}/${analysisLimit} analyses`;
      } else if (currentPlan === 'pro') {
        badge.textContent = `Pro Plan: Unlimited`;
      } else if (currentPlan === 'team') {
        badge.textContent = `Team Plan: Unlimited`;
      }
    }

    // ========================================
    // MAIN APP FUNCTIONS
    // ========================================
    function showMainApp() {
      hideAllScreens();
      document.getElementById('main-app').classList.remove('hidden');
      updatePlanBadge();
    }

    function hideAllScreens() {
      document.querySelectorAll('.onboarding-screen, .auth-screen, .pricing-screen').forEach(el => {
        el.classList.add('hidden');
      });
      document.getElementById('main-app').classList.add('hidden');
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      document.getElementById(`${tabName}-tab`).classList.remove('hidden');
      
      // Load data if needed
      if (tabName === 'history') {
        loadHistory();
      } else if (tabName === 'settings') {
        loadSettings();
      }
    }

    function showSettings() {
      switchTab('settings');
    }

    // ========================================
    // ANALYSIS FUNCTIONS
    // ========================================
    function analyzeFrame() {
      // Check if user has reached limit
      if (currentPlan === 'free' && analysisCount >= analysisLimit) {
        showUpgradePrompt();
        return;
      }
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'analyze',
          forceReanalyze: false,
          showOverlay: document.getElementById('show-overlays').checked,
          checks: getEnabledChecks()
        } 
      }, '*');
      
      analysisCount++;
      updatePlanBadge();
    }

    function reanalyzeFrame() {
      dismissChangeAlert();
      analyzeFrame();
    }

    function dismissChangeAlert() {
      document.getElementById('change-alert').classList.add('hidden');
    }

    function getEnabledChecks() {
      return {
        colorContrast: document.getElementById('check-color-contrast')?.checked ?? true,
        textSpacing: document.getElementById('check-text-spacing')?.checked ?? true,
        lineHeight: document.getElementById('check-line-height')?.checked ?? true,
        paragraphSpacing: document.getElementById('check-paragraph-spacing')?.checked ?? true,
        nonTextContrast: document.getElementById('check-non-text-contrast')?.checked ?? true,
      };
    }

    function showUpgradePrompt() {
      const resultsContainer = document.getElementById('results-container');
      resultsContainer.innerHTML = `
        <div class="upgrade-prompt">
          <div class="upgrade-badge">Free Plan Limit Reached</div>
          <h3>You've Used All 10 Analyses</h3>
          <p>Upgrade to Pro for unlimited analyses and more features</p>
          <button class="btn btn-primary btn-lg" onclick="showPricingScreen()">
            Upgrade to Pro - $9/month
          </button>
        </div>
      `;
    }

    // ========================================
    // SETTINGS FUNCTIONS
    // ========================================
    const wcagDescriptions = {
      '2.0-AA': 'WCAG 2.0 AA: Most widely supported. Required for US Section 508 compliance.',
      '2.0-AAA': 'WCAG 2.0 AAA: Enhanced accessibility with stricter contrast requirements.',
      '2.1-AA': 'WCAG 2.1 AA: Recommended. Includes mobile and touch accessibility requirements.',
      '2.1-AAA': 'WCAG 2.1 AAA: Enhanced mobile accessibility with stricter requirements.',
      '2.2-AA': 'WCAG 2.2 AA: Latest standard (2023). Includes focus appearance and more.',
      '2.2-AAA': 'WCAG 2.2 AAA: Strictest requirements. Future-proof your designs.',
    };

    function updateWCAGDescription() {
      const version = document.getElementById('wcag-version').value;
      const level = document.getElementById('wcag-level').value;
      const key = `${version}-${level}`;
      document.getElementById('wcag-description').textContent = wcagDescriptions[key];
    }

    function updateOpacityValue(value) {
      document.getElementById('opacity-value').textContent = `${value}%`;
    }

    function loadSettings() {
      parent.postMessage({ pluginMessage: { type: 'get-settings' } }, '*');
    }

    function saveSettings() {
      const settings = {
        wcag: {
          version: document.getElementById('wcag-version').value,
          level: document.getElementById('wcag-level').value,
        },
        checks: getEnabledChecks(),
        display: {
          showOverlays: document.getElementById('show-overlays').checked,
          groupByElement: document.getElementById('group-by-element').checked,
          showOnlyFailures: document.getElementById('show-only-failures').checked,
          overlayOpacity: parseInt(document.getElementById('overlay-opacity').value),
        },
        cache: {
          ttlDays: parseInt(document.getElementById('cache-ttl').value),
        },
      };
      
      parent.postMessage({ 
        pluginMessage: { 
          type: 'save-settings',
          settings 
        } 
      }, '*');
      
      showToast('Settings Saved', 'Your preferences have been updated.', 'success');
    }

    function clearAllCache() {
      if (confirm('Clear all cached analyses? This cannot be undone.')) {
        parent.postMessage({ pluginMessage: { type: 'clear-all-cache' } }, '*');
        showToast('Cache Cleared', 'All cached analyses have been removed.', 'success');
      }
    }

    // ========================================
    // HISTORY FUNCTIONS
    // ========================================
    function loadHistory() {
      parent.postMessage({ pluginMessage: { type: 'get-all-analyses' } }, '*');
    }

    function displayHistory(analyses) {
      const historyList = document.getElementById('history-list');
      
      if (!analyses || analyses.length === 0) {
        historyList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <h3>No History Yet</h3>
            <p>Your analysis history will appear here</p>
          </div>
        `;
        return;
      }

      historyList.innerHTML = analyses.map(analysis => {
        const date = new Date(analysis.analyzed_at);
        const issues = analysis.analysis_data?.issues || [];
        const failCount = issues.filter(i => i.severity === 'fail').length;
        const warnCount = issues.filter(i => i.severity === 'warning').length;

        return `
          <div class="card" style="cursor: pointer;" onclick="selectHistoryFrame('${analysis.frame_id}')">
            <div class="card-header">
              <div class="card-title">Frame Analysis</div>
              <div class="card-description">${date.toLocaleDateString()}</div>
            </div>
            <div class="card-content">
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                ${failCount > 0 ? `<span class="badge badge-destructive">${failCount} Critical</span>` : ''}
                ${warnCount > 0 ? `<span class="badge badge-warning">${warnCount} Warnings</span>` : ''}
                ${failCount === 0 && warnCount === 0 ? `<span class="badge badge-success">All Passed</span>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function selectHistoryFrame(frameId) {
      parent.postMessage({ 
        pluginMessage: { 
          type: 'select-frame',
          frameId 
        } 
      }, '*');
      switchTab('analyze');
    }

    // ========================================
    // DISPLAY RESULTS
    // ========================================
    function displayResults(results) {
      const container = document.getElementById('results-container');
      
      if (!results || results.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚úÖ</div>
            <h3>No Issues Found!</h3>
            <p>This frame passes all accessibility checks.</p>
          </div>
        `;
        return;
      }

      // Group by severity
      const critical = results.filter(r => r.severity === 'fail');
      const warnings = results.filter(r => r.severity === 'warning');

      let html = `
        <div class="card">
          <div class="card-header">
            <div class="card-title">Analysis Results</div>
            <div class="card-description">
              <div style="display: flex; gap: 8px; margin-top: 8px;">
                ${critical.length > 0 ? `<span class="badge badge-destructive">${critical.length} Critical</span>` : ''}
                ${warnings.length > 0 ? `<span class="badge badge-warning">${warnings.length} Warnings</span>` : ''}
              </div>
            </div>
          </div>
        </div>
      `;

      // Display issues
      [...critical, ...warnings].forEach((issue, index) => {
        html += `
          <div class="issue-card ${issue.severity}">
            <div class="issue-header">
              <span class="issue-title">${issue.issueType}</span>
              <span class="badge badge-${issue.severity === 'fail' ? 'destructive' : 'warning'}">
                ${issue.severity === 'fail' ? 'FAIL' : 'WARNING'}
              </span>
            </div>
            <div class="issue-details">
              <strong>Element:</strong> ${issue.elementName}<br>
              <strong>Current:</strong> ${issue.currentValue}<br>
              <strong>Required:</strong> ${issue.requiredValue} (WCAG ${issue.wcagLevel})
            </div>
            ${issue.suggestion ? `
              <div class="issue-details" style="margin-top: 8px;">
                <strong>üí° Suggestion:</strong> ${issue.suggestion}
              </div>
            ` : ''}
            ${issue.suggestedFix ? `
              <div class="issue-fix">
                <button class="btn btn-primary btn-sm" onclick="applyFix(${index})">
                  Apply Fix
                </button>
              </div>
            ` : ''}
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function applyFix(index) {
      parent.postMessage({
        pluginMessage: {
          type: 'apply-fix',
          issueIndex: index
        }
      }, '*');
    }

    // ========================================
    // TOAST NOTIFICATIONS
    // ========================================
    function showToast(title, message, type = 'info') {
      const container = document.getElementById('toast-container');
      
      const icons = {
        success: '‚úì',
        error: '‚úï',
        warning: '‚ö†',
        info: '‚Ñπ'
      };
      
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-icon">${icons[type] || '‚Ñπ'}</div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
      `;
      
      container.appendChild(toast);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }

    // ========================================
    // MESSAGE HANDLER (from code.ts)
    // ========================================
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      console.log('Received message:', msg.type);

      switch (msg.type) {
        case 'frame-changed':
          document.getElementById('change-alert').classList.remove('hidden');
          break;

        case 'frame-selected':
          const frameInfo = document.getElementById('frame-info-text');
          if (frameInfo) {
            frameInfo.textContent = `${msg.frameName} (${msg.layerCount || 0} layers)`;
          }
          const analyzeBtn = document.getElementById('analyze-btn');
          if (analyzeBtn) {
            analyzeBtn.disabled = false;
          }
          break;

        case 'no-frame-selected':
          const noFrameInfo = document.getElementById('frame-info-text');
          if (noFrameInfo) {
            noFrameInfo.textContent = 'No frame selected';
          }
          const noAnalyzeBtn = document.getElementById('analyze-btn');
          if (noAnalyzeBtn) {
            noAnalyzeBtn.disabled = true;
          }
          break;

        case 'analysis-progress':
          const progressFill = document.getElementById('progress-fill');
          const progressStats = document.getElementById('progress-stats');
          if (progressFill) {
            progressFill.style.width = (msg.progress || 0) + '%';
          }
          if (progressStats) {
            progressStats.textContent = `${msg.current || 0} / ${msg.total || 0} elements`;
          }
          break;

        case 'analysis-complete':
          displayResults(msg.issues, msg.totalIssues, msg.fromCache, msg.cacheAge);
          showToast('Analysis Complete', `Found ${msg.totalIssues} issues`, msg.totalIssues > 0 ? 'warning' : 'success');
          break;

        case 'cache-available':
          showCacheStatus(msg.age, msg.hasChanges);
          break;

        case 'cache-cleared':
          hideCacheStatus();
          showToast('Cache', 'Cache cleared successfully', 'success');
          break;

        case 'analysis-paused':
          showToast('Paused', 'Analysis paused', 'warning');
          break;

        case 'analysis-resumed':
          showToast('Resumed', 'Analysis resumed', 'success');
          break;

        case 'error':
          showToast('Error', msg.message, 'error');
          break;

        case 'font-error':
          showToast('Font Warning', msg.message, 'warning');
          break;

        case 'settings-loaded':
          populateSettings(msg.settings);
          break;

        case 'all-analyses':
          displayHistory(msg.analyses);
          break;

        case 'notification':
          showToast('Notification', msg.message, msg.level || 'info');
          break;
      }
    });

    function populateSettings(settings) {
      if (!settings) return;

      // WCAG
      if (settings.wcag) {
        const versionSelect = document.getElementById('wcag-version');
        const levelSelect = document.getElementById('wcag-level');
        if (versionSelect) versionSelect.value = settings.wcag.version || '2.1';
        if (levelSelect) levelSelect.value = settings.wcag.level || 'AA';
        updateWCAGDescription();
      }

      // Checks
      if (settings.checks) {
        const checkIds = [
          'check-color-contrast',
          'check-text-spacing',
          'check-line-height',
          'check-paragraph-spacing',
          'check-non-text-contrast'
        ];
        
        checkIds.forEach(id => {
          const checkbox = document.getElementById(id);
          if (checkbox) {
            const key = id.replace('check-', '').replace(/-([a-z])/g, (g) => g[1].toUpperCase());
            checkbox.checked = settings.checks[key] !== false;
          }
        });
      }

      // Display
      if (settings.display) {
        const overlaysCheckbox = document.getElementById('show-overlays');
        if (overlaysCheckbox) overlaysCheckbox.checked = settings.display.showOverlays !== false;
        
        const groupCheckbox = document.getElementById('group-by-element');
        if (groupCheckbox) groupCheckbox.checked = settings.display.groupByElement !== false;
        
        const failuresCheckbox = document.getElementById('show-only-failures');
        if (failuresCheckbox) failuresCheckbox.checked = settings.display.showOnlyFailures === true;
        
        const opacity = settings.display.overlayOpacity || 70;
        const opacitySlider = document.getElementById('overlay-opacity');
        if (opacitySlider) {
          opacitySlider.value = opacity;
          updateOpacityValue(opacity);
        }
      }

      // Cache
      if (settings.cache) {
        const ttlInput = document.getElementById('cache-ttl');
        if (ttlInput) ttlInput.value = settings.cache.ttlDays || 7;
      }
    }

    // ========================================
    // RESULTS DISPLAY FUNCTIONS
    // ========================================
    function displayResults(groupedIssues, totalIssues, fromCache, cacheAge) {
      const resultsContainer = document.getElementById('results-container');
      if (!resultsContainer) return;

      if (totalIssues === 0) {
        resultsContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚úÖ</div>
            <h3>Perfect Accessibility!</h3>
            <p>This frame passes all WCAG checks.</p>
          </div>
        `;
        return;
      }

      let html = `<div class="results-header">
        <h3>üìä Analysis Results</h3>
        ${fromCache ? `<span class="cache-badge">üíæ Cached ${cacheAge}</span>` : ''}
      </div>`;

      // Group by severity
      const failIssues = (groupedIssues || []).filter(g => g.issues.some(i => i.severity === 'fail'));
      const warnIssues = (groupedIssues || []).filter(g => g.issues.some(i => i.severity === 'warning'));

      failIssues.forEach(group => {
        html += renderIssueGroup(group, 'fail');
      });

      warnIssues.forEach(group => {
        html += renderIssueGroup(group, 'warning');
      });

      resultsContainer.innerHTML = html;
    }

    function renderIssueGroup(group, severity) {
      const severityClass = severity === 'fail' ? 'critical' : 'warning';
      const severityIcon = severity === 'fail' ? '‚ùå' : '‚ö†Ô∏è';

      let html = `<div class="issue-group">
        <div class="issue-group-header">
          <span>${severityIcon} ${group.elementName}</span>
          <button class="btn-jump" onclick="parent.postMessage({pluginMessage:{type:'jump-to-element',elementId:'${group.elementId}'}}, '*')">
            Jump to
          </button>
        </div>`;

      group.issues.filter(i => i.severity === severity).forEach(issue => {
        html += `<div class="issue-item issue-${severity}">
          <div class="issue-type">${issue.issueType}</div>
          <div class="issue-details">
            <strong>Current:</strong> ${issue.currentValue}<br>
            <strong>Required:</strong> ${issue.requiredValue} (WCAG ${issue.wcagLevel})
          </div>
          ${issue.suggestion ? `<div class="issue-suggestion">üí° ${issue.suggestion}</div>` : ''}
        </div>`;
      });

      html += `</div>`;
      return html;
    }

    function displayHistory(analyses) {
      const historyContainer = document.getElementById('history-container');
      if (!historyContainer || !analyses || analyses.length === 0) {
        if (historyContainer) {
          historyContainer.innerHTML = `
            <div class="empty-state">
              <p>No analysis history yet</p>
            </div>
          `;
        }
        return;
      }

      let html = `<div class="history-list">`;
      
      analyses.forEach(analysis => {
        const date = new Date(analysis.analyzed_at);
        const timeAgo = getTimeAgo(date);
        const issues = analysis.analysis_data?.issues || [];
        const failCount = issues.filter(i => i.severity === 'fail').length;
        const warnCount = issues.filter(i => i.severity === 'warning').length;

        html += `<div class="history-item">
          <div class="history-header">
            <strong>${analysis.frame_name}</strong>
            <span class="history-time">${timeAgo}</span>
          </div>
          <div class="history-stats">
            ${failCount > 0 ? `<span class="badge-fail">${failCount} Critical</span>` : ''}
            ${warnCount > 0 ? `<span class="badge-warn">${warnCount} Warnings</span>` : ''}
            ${failCount === 0 && warnCount === 0 ? `<span class="badge-pass">‚úì Passed</span>` : ''}
          </div>
        </div>`;
      });

      html += `</div>`;
      historyContainer.innerHTML = html;
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return 'just now';
      if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
      if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
      return date.toLocaleDateString();
    }

    function showCacheStatus(age, hasChanges) {
      const cacheStatusEl = document.getElementById('cache-status');
      if (cacheStatusEl) {
        cacheStatusEl.classList.remove('hidden');
        cacheStatusEl.innerHTML = `
          <span>üíæ Cached results from ${age}</span>
          ${hasChanges ? '<span class="badge-warn">Frame changed</span>' : ''}
        `;
      }
    }

    function hideCacheStatus() {
      const cacheStatusEl = document.getElementById('cache-status');
      if (cacheStatusEl) {
        cacheStatusEl.classList.add('hidden');
      }
    }

    // ========================================
    // INITIALIZATION
    // ========================================
    function initializeApp() {
      const onboardingCompleted = localStorage.getItem('a11y-onboarding-completed');
      
      if (onboardingCompleted) {
        // Check if user is authenticated
        // TODO: Implement actual auth check
        const isAuthChecked = localStorage.getItem('a11y-auth-checked');
        
        if (isAuthChecked) {
          showMainApp();
        } else {
          showLoginScreen();
        }
      } else {
        showOnboarding();
      }
      
      // Set WCAG description
      updateWCAGDescription();
      
      console.log('A11y Audit Pro initialized');
    }

    // Start the app
    initializeApp();
  </script>
</body>
</html>